{% extends 'metodos_numericos/base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Método Simplex - Métodos Numéricos" %}{% endblock %}

{% block content %}
<button class="theme-toggle bg-secondary-neon" onclick="toggleTheme()" title="{% trans 'Cambiar tema' %}">
    <i class="fas fa-moon" id="theme-icon"></i>
</button>

<div class="row justify-content-end">
    <div class="col-12">
        <h2 class="mb-4 text-info">
            <i class="fas fa-chart-bar text-info me-2"></i>
            {% trans "Método Simplex - Programación Lineal" %}
            <span class="tooltip-trigger ms-2" data-tooltip="method-info">
                <i class="fas fa-info-circle text-muted"></i>
            </span>
        </h2>
    </div> 
</div>

<div class="row text-dark">
    <div class="col-12 col-lg-5" id="entrada-datos">
        <div class="card shadow-sm">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0">
                    <i class="fas fa-keyboard me-2"></i>{% trans "Datos de entrada" %}
                    <span class="tooltip-trigger ms-2" data-tooltip="input-data">
                        <i class="fas fa-question-circle"></i>
                    </span>
                </h4>
            </div>
            <div class="card-body">
                <form method="post" id="simplexForm">
                    {% csrf_token %}
                    
                    <!-- Configuración básica -->
                    <div class="row mb-4 mt-2">
                        <div class="col-md-6">
                            <label class="form-label fw-bold">
                                <i class="fas fa-target me-1"></i>{% trans "Optimización" %}
                                <span class="tooltip-trigger ms-1" data-tooltip="optimization-type">
                                    <i class="fas fa-info-circle text-muted small"></i>
                                </span>
                            </label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo_optimizacion" 
                                       id="maximizar" value="maximizar" 
                                       {% if tipo_optimizacion == 'maximizar' or not tipo_optimizacion %}checked{% endif %}>
                                <label class="form-check-label" for="maximizar">
                                    {% trans "Maximizar" %}
                                    <span class="tooltip-trigger ms-1" data-tooltip="maximize">
                                        <i class="fas fa-arrow-up text-success small"></i>
                                    </span>
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="tipo_optimizacion" 
                                       id="minimizar" value="minimizar"
                                       {% if tipo_optimizacion == 'minimizar' %}checked{% endif %}>
                                <label class="form-check-label" for="minimizar">
                                    {% trans "Minimizar" %}
                                    <span class="tooltip-trigger ms-1" data-tooltip="minimize">
                                        <i class="fas fa-arrow-down text-danger small"></i>
                                    </span>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="num_variables" class="form-label fw-bold">
                                <i class="fas fa-hashtag me-1"></i>{% trans "Variables" %}
                                <span class="tooltip-trigger ms-1" data-tooltip="variables-count">
                                    <i class="fas fa-info-circle text-muted small"></i>
                                </span>
                            </label>
                            <select class="form-select" id="num_variables" onchange="generarCamposVariables()">
                                <option value="2" {%if num_variables == 2 or num_variables == None%}selected{%endif%}>2 variables</option>
                                <option value="3" {%if num_variables == 3%}selected{%endif%}>3 variables</option>
                                <option value="4" {%if num_variables == 4%}selected{%endif%}>4 variables</option>
                                <option value="5" {%if num_variables == 5%}selected{%endif%}>5 variables</option>
                                <option value="6" {%if num_variables == 6%}selected{%endif%}>6 variables</option>
                                <option value="7" {%if num_variables == 7%}selected{%endif%}>7 variables</option>
                                <option value="8" {%if num_variables == 8%}selected{%endif%}>8 variables</option>
                            </select>
                        </div>
                    </div>

                    <!-- Nombres de variables -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-tag me-1"></i>{% trans "Nombres de Variables" %}
                            <span class="tooltip-trigger ms-1" data-tooltip="variable-names">
                                <i class="fas fa-info-circle text-muted small"></i>
                            </span>
                        </label>
                        <div class="table-responsive table-container">
                            <table class="table table-sm table-bordered" id="variables-table">
                                <thead class="table-primary">
                                    <tr id="variables-header">
                                        <!-- Se genera dinámicamente -->
                                         {%if ejercicio_db %}
                                            {% for variable in nombres_variables_db %}
                                            <th class="text-center" style="min-width: 80px;">Variable {{forloop.counter}}</th>
                                            {% endfor %}
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr id="variables-names">
                                        <!-- Se genera dinámicamente -->
                                        {%if ejercicio_db %}
                                            {% for variable in nombres_variables_db %}
                                            <td><input id="nombre_var_{{forloop.counter|add:"-1"}}" class="form-control form-control-sm text-center variable-name-input" type="text" value="{{ variable }}"
                                                onchange="actualizarNombreVariable({{forloop.counter|add:"-1"}}, this.value)" placeholder="x{{forloop.counter}}"></td>
                                            {% endfor %}
                                        {% endif %}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <small class="text-muted">{% trans "Personaliza los nombres de tus variables" %}</small>
                    </div>
                    
                    <!-- Función objetivo -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-function me-1"></i>{% trans "Función Objetivo" %}
                            <span class="tooltip-trigger ms-1" data-tooltip="objective-function">
                                <i class="fas fa-info-circle text-muted small"></i>
                            </span>
                        </label>
                        <div class="table-responsive table-container">
                            <table class="table table-sm table-bordered" id="objetivo-table">
                                <thead class="table-success">
                                    <tr id="objetivo-header">
                                        <!-- Se genera dinámicamente -->
                                         {%if ejercicio_db %}
                                            {% for variable in nombres_variables_db %}
                                            <th class="text-center" style="min-width: 120px;">
                                                <span id="obj_label_{{forloop.counter|add:"-1"}}">{{variable}}</span>
                                            </th>
                                            {% endfor %}
                                        {% endif %}
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr id="objetivo-coeficientes">
                                        <!-- Se genera dinámicamente -->
                                    {%if ejercicio_db %}
                                        {% for variable in funcion_objetivo_input_db %}
                                        <td>
                                            <input type="number" class="form-control form-control-sm text-center objetivo-input" name="coef_obj_{{forloop.counter|add:"-1"}}" step="any" placeholder="{{forloop.counter|add:"-1"}}" id="coef_obj_{{forloop.counter|add:"-1"}}"
                                            value="{{ variable }}">
                                        </td>
                                        {% endfor %}
                                    {% endif %}
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <small class="text-muted">{% trans "Coeficientes de cada variable en la función objetivo" %}</small>
                    </div>
                    
                    <!-- Restricciones -->
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-list me-1"></i>{% trans "Restricciones" %}
                            <span class="tooltip-trigger ms-1" data-tooltip="constraints">
                                <i class="fas fa-info-circle text-muted small"></i>
                            </span>
                        </label>
                        <div class="table-responsive table-container force-horizontal-scroll" style="max-height: 400px; overflow-y: auto;">
                            <table class="table table-sm table-bordered" id="restricciones-table">
                                <thead class="table-warning sticky-top">
                                    <tr id="restricciones-header">
                                        <th class="text-center" style="min-width: 60px;">#</th>
                                        <!-- Variables se generan dinámicamente -->
                                        {%if ejercicio_db %}
                                            {% for variable in nombres_variables_db %}
                                            <th class="text-center" style="min-width: 100px;">
                                                <span id="rest_label_{{forloop.counter|add:"-1"}}">{{variable}}</span>
                                            </th>
                                            {% endfor %}
                                        {% endif %}
                                        <th class="text-center" style="min-width: 80px;">
                                            {% trans "Tipo" %}
                                            <span class="tooltip-trigger ms-1" data-tooltip="constraint-types">
                                                <i class="fas fa-info-circle text-muted small"></i>
                                            </span>
                                        </th>
                                        <th class="text-center" style="min-width: 100px;">{% trans "Valor" %}</th>
                                        <th class="text-center" style="min-width: 80px;">{% trans "Acción" %}</th>
                                    </tr>
                                </thead>
                                <tbody id="restricciones-tbody">
                                    <!-- Las restricciones se añaden dinámicamente -->
                                     {% load index_filters %}
                                    {%if ejercicio_db %}
                                        {% for _ in ""|center:num_restricciones %}
                                            <tr class="restriccion-row" id="restriccion_{{forloop.counter|add:"-1"}}" style="opacity: 1; transform: translateY(0px); transition: 0.3s;">
                                                <td class="text-center fw-bold">{{forloop.counter}}</td>
                                                {% for coef in coeficientes_restricciones|index:forloop.counter0 %}
                                                    <td>
                                                        {% with coef_float=coef|floatformat:"-6" %}
                                                            <input class="form-control form-control-sm text-center restriccion-input" type="number" value="{{ coef_float }}" name="restriccion_{{forloop.parentloop.counter|add:"-1"}}_coef_{{forloop.counter|add:"-1"}}"
                                                             step="any" placeholder="{{forloop.parentloop.counter|add:"-1"}}">
                                                        </td>
                                                        {% endwith %}
                                                {% endfor %}
                                                <td style="min-width:80px">
                                                    <select class="form-select form-select-sm" 
                                                            name="restriccion_{{forloop.counter|add:"-1"}}_tipo">
                                                            <option value="<=" {% if tipo_restricciones|index:forloop.counter0 == '<=' %}selected{% endif %}>&le;</option>
                                                            <option value=">=" {% if tipo_restricciones|index:forloop.counter0 == '>=' %}selected{% endif %}>&ge;</option>
                                                            <option value="=" {% if tipo_restricciones|index:forloop.counter0 == '=' %}selected{% endif %}>=</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <input type="number" class="form-control form-control-sm text-center restriccion-valor" name="restriccion_{{forloop.counter|add:"-1"}}_valor" placeholder="0" step="any" required="" value="{{ valores_restricciones|index:forloop.counter0|floatformat:"-6" }}">
                                                </td>
                                                <td>
                                                    <button type="button" class="btn btn-outline-danger btn-sm" 
                                                            onclick="eliminarRestriccion({{forloop.counter|add:"-1"}})"
                                                            title="Eliminar restricción">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                        <div class="d-flex gap-2 mt-3">
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="agregarRestriccion()">
                                <i class="fas fa-plus me-1"></i>{% trans "Añadir Restricción" %}
                            </button>
                            <button type="button" class="btn btn-outline-success btn-sm" onclick="cargarEjemplo()" 
                                    data-tooltip="example-load">
                                <i class="fas fa-lightbulb me-1"></i>{% trans "Cargar Ejemplo" %}
                            </button>
                            {% if mantener_datos %}
                            <button type="button" class="btn btn-outline-warning btn-sm" onclick="limpiarFormulario()">
                                <i class="fas fa-eraser me-1"></i>{% trans "Limpiar Todo" %}
                            </button>
                            {% endif %}
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-info w-100 btn-lg" data-tooltip="solve-button">
                        <i class="fas fa-calculator me-2"></i>{% trans "Resolver con Simplex" %}
                    </button>
                </form>
                
                <!-- Problema actual -->
                <div class="mt-4 p-3 bg-light rounded" id="problema-actual">
                  <!-- Se actualiza dinámicamente con JS -->
                  <h5>{% trans "Ingresa los valores de tu ejercicio para visualizarlo" %}</h5>
                </div>

            </div>
        </div>
    </div>
    
    <div class="col-12 col-lg-7">
        {% if solucion is not None %}
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="mb-0">
                    <i class="fas fa-check-circle me-2"></i>{% trans "Solución Óptima" %}
                    <span class="tooltip-trigger ms-2" data-tooltip="optimal-solution">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </h4>
            </div>
            <div class="card-body">
                <div class="alert alert-success ps-2 pb-2 pt-1">
                    <h5 class="mb-3">
                        <i class="fas fa-bullseye me-2"></i>{% trans "Variables:" %}
                        <span class="tooltip-trigger ms-1" data-tooltip="solution-variables">
                            <i class="fas fa-info-circle text-muted small"></i>
                        </span>
                    </h5>
                    <div class="row">
                        {% if solucion_con_nombres %}
                            {% for nombre, valor in solucion_con_nombres.items %}
                                <div class="col-md-6 mb-2">
                                    <strong>{{ nombre }} = {{ valor|floatformat:6 }}</strong>
                                </div>
                            {% endfor %}
                        {% else %}
                            {% for valor in solucion %}
                                <div class="col-md-6 mb-2">
                                    <strong>x{{ forloop.counter }} = {{ valor|floatformat:6 }}</strong>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                    <hr>
                    <h4 class="text-center mb-0 text-warning" id="valor-optimo">
                        <i class="fas fa-trophy me-2 text-warning"></i>{% trans "Valor óptimo:" %} Z = {{ valor_objetivo|floatformat:6 }}
                        <span class="tooltip-trigger ms-2" data-tooltip="optimal-value">
                            <i class="fas fa-info-circle text-muted"></i>
                        </span>
                    </h4>
                        {% if tipo_optimizacion == 'minimizar' %}
                            <small class="d-block text-muted mt-1" style="font-size: 0.7em;">
                                ({% trans "Problema de minimización" %})
                            </small>
                        {% endif %}
                </div>
                
                <div class="row text-center mt-3">
                    <div class="col-md-4">
                        <div class="bg-light p-3 rounded">
                            <small class="text-muted d-block">{% trans "Tipo" %}</small>
                            <strong>{{ tipo_optimizacion|title }}</strong>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="bg-light p-3 rounded">
                            <small class="text-muted d-block">{% trans "Variables" %}</small>
                            <strong>{{ solucion|length }}</strong>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="bg-light p-3 rounded">
                            <small class="text-muted d-block">{% trans "Restricciones" %}</small>
                            <strong>{{ num_restricciones }}</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if metodo_usado %}
            <div class="alert alert-info d-flex align-items-center mb-3 ps-2 pt-1 bg-light">
                <i class="fas fa-info-circle me-2"></i>
                <div>
                    <strong>{% trans "Método utilizado:" %}</strong> 
                    <span class="metodo-indicator {% if metodo_usado == 'Gran M' %}metodo-gran-m{% else %}metodo-simplex{% endif %}">
                        {% if metodo_usado == 'Gran M' %}
                            🔢 {% trans "Método de la Gran M" %}
                        {% else %}
                            📊 {% trans "Simplex Estándar" %}
                        {% endif %}
                    </span>
                    <span class="tooltip-trigger ms-2" data-tooltip="method-used">
                        <i class="fas fa-info-circle text-muted small"></i>
                    </span>
                    <br>
                    <small class="text-muted">
                        {% if metodo_usado == 'Gran M' %}
                            {% trans "Se utilizó el método de la Gran M debido a restricciones de tipo ≥ o =" %}
                        {% else %}
                            {% trans "Se utilizó el método Simplex estándar (todas las restricciones son ≤)" %}
                        {% endif %}
                    </small>
                </div>
            </div>
            {% endif %}
        
        <div class="mb-3 d-flex justify-content-end">
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-export btn-export-pdf" onclick="exportarAPDF()" title="{% trans 'Exportar a PDF' %}">
                    <i class="fas fa-file-pdf me-1"></i>PDF
                </button>
                <button type="button" class="btn btn-export btn-export-word" onclick="exportarAWord()" title="{% trans 'Exportar a Word' %}">
                    <i class="fas fa-file-word me-1"></i>Word
                </button>
                <button type="button" class="btn btn-export btn-export-excel" onclick="exportarAExcel()" title="{% trans 'Exportar a Excel' %}">
                    <i class="fas fa-file-excel me-1"></i>Excel
                </button>
            </div>
        </div>
        
        <div class="card mt-3 shadow-sm">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0">
                    <i class="fas fa-table me-2"></i>{% trans "Proceso Simplex Paso a Paso" %}
                    <span class="tooltip-trigger ms-2" data-tooltip="step-by-step">
                        <i class="fas fa-info-circle"></i>
                    </span>
                </h4>
            </div>
            <div class="card-body">
                <div class="solution-steps">
                    {% for paso in pasos %}
                        {% if "===" in paso %}
                            <h3 class="text-info mt-3">{{ paso|slice:"3:-3" }}</h3>
                        {% elif paso == "" %}
                            
                        {% elif "ITERACIÓN" in paso %}
                            <h4 class="text-warning mt-4 mb-3">
                                <i class="fas fa-step-forward me-2"></i>{{ paso }}
                            </h4>
                        {% elif "📋 PROBLEMA ORIGINAL:" in paso %}
                            <h5 class="text-primary mt-3">
                                <i class="fas fa-clipboard me-2"></i>{{ paso|slice:"2:" }}
                            </h5>
                        {% elif "🔍 DETECCIÓN DEL MÉTODO:" in paso %}
                            <h5 class="text-info mt-3">
                                <i class="fas fa-search me-2"></i>{{ paso|slice:"2:" }}
                            </h5>
                        {% elif "🔄 CONVERSIÓN A FORMA ESTÁNDAR:" in paso %}
                            <h5 class="text-success mt-3">
                                <i class="fas fa-sync me-2"></i>{{ paso|slice:"2:" }}
                            </h5>
                        {% elif "📊 MÉTODO DE LA GRAN M:" in paso %}
                            <div class="alert alert-warning py-2 mb-2 ps-2">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>{{ paso|slice:"2:" }}</strong>
                            </div>
                        {% elif "✅ FORMA ESTÁNDAR OBTENIDA:" in paso %}
                            <h5 class="text-success mt-3">
                                <i class="fas fa-check-circle me-2"></i>{{ paso|slice:"2:" }}
                            </h5>
                        {% elif "🔧 ELIMINACIÓN DE VARIABLES ARTIFICIALES" in paso %}
                            <h5 class="text-warning mt-3">
                                <i class="fas fa-tools me-2"></i>{{ paso|slice:"2:" }}
                            </h5>
                        {% elif "📋 TABLA SIMPLEX:" in paso %}
                            <h5 class="text-success mt-3">
                                <i class="fas fa-table me-2"></i>{{ paso|slice:"2:" }}
                            </h5>
                        {% elif "<div class=\"simplex-table-container\">" in paso %}
                            {{ paso|safe }}
                        {% elif "🔵 VARIABLE ENTRANTE:" in paso %}
                            <div class="alert alert-info py-2 mb-2 ps-2">
                                <i class="fas fa-arrow-right me-2"></i>
                                <strong>{{ paso|slice:"2:" }}</strong>
                            </div>
                        {% elif "🔴 VARIABLE SALIENTE:" in paso %}
                            <div class="alert alert-danger py-2 mb-2 ps-2">
                                <i class="fas fa-arrow-left me-2"></i>
                                <strong>{{ paso|slice:"2:" }}</strong>
                            </div>
                        {% elif "⚡ ELEMENTO PIVOTE:" in paso %}
                            <div class="alert alert-warning py-2 mb-2 ps-2">
                                <i class="fas fa-crosshairs me-2"></i>
                                <strong>{{ paso|slice:"2:" }}</strong>
                            </div>
                        {% elif "📊 PRUEBA DE RAZÓN MÍNIMA:" in paso %}
                            <h5 class="text-primary mt-3">
                                <i class="fas fa-calculator me-2"></i>{{ paso|slice:"2:" }}
                            </h5>
                        {% elif "🔧 OPERACIONES DE PIVOTEO:" in paso %}
                            <h5 class="text-warning mt-3">
                                <i class="fas fa-cogs me-2"></i>{{ paso|slice:"2:" }}
                            </h5>
                        {% elif "1️⃣" in paso or "2️⃣" in paso or "3️⃣" in paso %}
                            <h5 class="text-info mt-2">{{ paso }}</h5>
                        {% elif "✓" in paso %}
                            <div class="alert alert-success py-2 ps-2">
                                <i class="fas fa-check-circle me-2"></i>{{ paso|slice:"2:" }}
                            </div>
                        {% elif "❌" in paso %}
                            <div class="alert alert-danger py-2 ps-2">
                                <i class="fas fa-exclamation-triangle me-2"></i>{{ paso|slice:"2:" }}
                            </div>
                        {% elif "🎯" in paso %}
                            <div class="alert alert-success py-2 ps-2">
                                <i class="fas fa-bullseye me-2"></i>
                                <strong>{{ paso|slice:"2:" }}</strong>
                            </div>
                        {% elif "📋" in paso or "📊" in paso %}
                            <h5 class="text-info mt-3">{{ paso }}</h5>
                        {% elif "🔍 INTERPRETACIÓN:" in paso %}
                            <h6 class="text-warning mt-2">{{ paso|slice:"2:" }}</h6>
                        {% elif paso|slice:":3" == "   " %}
                            <pre class="bg-light p-2 rounded small mb-1">{{ paso }}</pre>
                        {% elif paso|slice:":2" == "1." or paso|slice:":2" == "2." or paso|slice:":2" == "3." %}
                            <h5 class="text-info mt-3">{{ paso }}</h5>
                        {% else %}
                            <p class="mb-1">{{ paso }}</p>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
        
        {% elif error %}
        <div class="card shadow-sm">
            <div class="card-header bg-danger text-white">
                <h4 class="mb-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>{% trans "Error en la Solución" %}
                </h4>
            </div>
            <div class="card-body">
                <div class="alert alert-danger ps-2">
                    <h5><i class="fas fa-times-circle me-2"></i>{{ error }}</h5>
                    {% if interpretacion %}
                        <hr>
                        <p class="mb-1"><strong>{% trans "Interpretación:" %}</strong> {{ interpretacion }}</p>
                    {% endif %}
                    {% if sugerencia %}
                        <p class="mb-0"><strong>{% trans "Sugerencia:" %}</strong> {{ sugerencia }}</p>
                    {% endif %}
                </div>
                
                {% if pasos %}
                <div class="card mt-3">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-list me-2"></i>{% trans "Proceso hasta el Error" %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="solution-steps">
                            {% for paso in pasos %}
                                {% if "===" in paso %}
                                    <h4 class="text-info">{{ paso|slice:"3:-3" }}</h4>
                                {% elif "<div class=\"simplex-table-container\">" in paso %}
                                    {{ paso|safe }}
                                {% elif "🔵 VARIABLE ENTRANTE:" in paso %}
                                    <div class="alert alert-info py-2 mb-2 ps-2">
                                        <strong>{{ paso|slice:"2:" }}</strong>
                                    </div>
                                {% elif "❌" in paso %}
                                    <div class="alert alert-danger py-2 ps-2">
                                        {{ paso|slice:"2:" }}
                                    </div>
                                {% elif paso != "" %}
                                    <p class="mb-1">{{ paso }}</p>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        
        {% else %}
        <div class="card shadow-sm">
            <div class="card-body text-center py-5">
                <i class="fas fa-arrow-left fa-4x text-muted mb-4"></i>
                <h4 class="text-muted">{% trans "Configura tu problema de programación lineal" %}</h4>
                <p class="text-muted">{% trans "Completa la configuración de la izquierda para resolver usando el método Simplex." %}</p>
                
                <div class="mt-4">
                    <h6 class="text-info">{% trans "Pasos para resolver:" %}</h6>
                    <ol class="text-start text-muted">
                        <li>{% trans "Selecciona el tipo de optimización (maximizar/minimizar)" %}</li>
                        <li>{% trans "Define el número de variables de decisión" %}</li>
                        <li>{% trans "Personaliza los nombres de las variables (opcional)" %}</li>
                        <li>{% trans "Ingresa los coeficientes de la función objetivo" %}</li>
                        <li>{% trans "Añade las restricciones del problema" %}</li>
                        <li>{% trans "Haz clic en 'Resolver con Simplex'" %}</li>
                    </ol>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<div class="container-fluid p-0 m-auto">
  {% if datos_grafica %}
  <div class="card shadow-sm mb-3">
    <div class="card-header bg-warning-neon text-dark">
      <h4 class="mb-0">
        <i class="fas fa-chart-area me-2"></i>{% trans "Gráfica de Programación Lineal" %}
        <span class="tooltip-trigger ms-2" data-tooltip="graph-explanation">
            <i class="fas fa-info-circle text-muted"></i>
        </span>
      </h4>
    </div>
    <div class="card-body p-2">
      <div id="simplex-graph" style="width: 100%; height: 600px; min-height: 500px;"></div>
      <div id="simplex-graph-instructions" class="mt-3">
        <!-- Las instrucciones se cargan dinámicamente -->
      </div>
    </div>
  </div>
  {% elif num_variables == 2 %}
  <div class="card shadow-sm mb-3">
    <div class="card-body text-center py-4">
      <i class="fas fa-chart-area fa-3x text-muted mb-3"></i>
      <h5 class="text-muted">{% trans "Gráfica de Programación Lineal" %}</h5>
      <p class="text-muted">{% trans "La gráfica se mostrará aquí una vez que resuelvas el problema con 2 variables." %}</p>
    </div>
  </div>
  {% elif num_variables > 2 %}
  <div class="card shadow-sm mb-3">
    <div class="card-body text-center py-4">
      <i class="fas fa-cube fa-3x text-muted mb-3"></i>
      <h5 class="text-muted">{% trans "Gráfica no disponible" %}</h5>
      <p class="text-muted">{% trans "La visualización gráfica solo está disponible para problemas con 2 variables." %}</p>
      <small class="text-muted">{% blocktrans with num_variables=num_variables %}Tu problema tiene {{ num_variables }} variables.{% endblocktrans %}</small>
    </div>
  </div>
  {% endif %}
</div>

<!-- Tooltip Container -->
<div id="tooltip-container" class="custom-tooltip" style="display: none;">
    <div class="tooltip-content">
        <div class="tooltip-header">
            <span class="tooltip-title"></span>
            <button class="tooltip-close" onclick="hideTooltipContent()">&times;</button>
        </div>
        <div class="tooltip-body"></div>
    </div>
</div>

{% if mantener_datos %}
<script>
// Pasar datos para rellenar
window.datosSimplexTemplate = {
    num_variables: {{ num_variables|default:2 }},
    tipo_optimizacion: '{{ tipo_optimizacion|default:"maximizar" }}',
    nombres_variables: {{ nombres_variables|safe|default:"[]" }},
    funcion_objetivo_valores: {{ funcion_objetivo_valores|safe|default:"[]" }},
    restricciones_data: {{ restricciones_data|safe|default:"[]" }}
};
</script>
<div data-mantener-datos="true" style="display: none;"></div>
{% endif %}

<!-- Pasar traducciones a JavaScript -->
<script>
window.translations = {
    'Variable': '{% trans "Variable" %}',
    'Eliminar restricción': '{% trans "Eliminar restricción" %}',
    'Problema actual Ingresado': '{% trans "Problema actual Ingresado" %}',
    'Problema:': '{% trans "Problema:" %}',
    'Sujeto a:': '{% trans "Sujeto a:" %}',
    'Maximizar': '{% trans "Maximizar" %}',
    'Minimizar': '{% trans "Minimizar" %}',
    'Ejemplo cargado: Maximizar 3x₁ + 2x₂ con 2 restricciones': '{% trans "Ejemplo cargado: Maximizar 3x₁ + 2x₂ con 2 restricciones" %}',
    'Formulario limpiado correctamente': '{% trans "Formulario limpiado correctamente" %}',
    '¿Limpiar formulario?': '{% trans "¿Limpiar formulario?" %}',
    'Se perderán todos los datos ingresados': '{% trans "Se perderán todos los datos ingresados" %}',
    'Sí, limpiar': '{% trans "Sí, limpiar" %}',
    'Cancelar': '{% trans "Cancelar" %}',
    'Debe ser un número válido': '{% trans "Debe ser un número válido" %}',
    'Elemento Pivote:': '{% trans "Elemento Pivote:" %}',
    'Ingresa los valores de tu ejercicio para visualizarlo': '{% trans "Ingresa los valores de tu ejercicio para visualizarlo" %}'
};

// Tooltips content con traducciones
window.tooltipsContent = {
    'method-info': {
        title: '{% trans "Método Simplex" %}',
        content: '{% trans "El método Simplex es un algoritmo para resolver problemas de programación lineal. Encuentra la solución óptima moviéndose entre vértices de la región factible hasta encontrar el mejor valor de la función objetivo." %}'
    },
    'input-data': {
        title: '{% trans "Datos de entrada" %}',
        content: '{% trans "Aquí defines tu problema de programación lineal: función objetivo, variables y restricciones. Completa todos los campos para obtener la solución óptima." %}'
    },
    'optimization-type': {
        title: '{% trans "Optimización" %}',
        content: '{% trans "Selecciona si quieres encontrar el valor máximo o mínimo de tu función objetivo. Esto determina la dirección de búsqueda del algoritmo." %}'
    },
    'maximize': {
        title: '{% trans "Maximizar" %}',
        content: '{% trans "Busca el mayor valor posible de la función objetivo. Útil para problemas de maximización de ganancias, producción, etc." %}'
    },
    'minimize': {
        title: '{% trans "Minimizar" %}',
        content: '{% trans "Busca el menor valor posible de la función objetivo. Útil para problemas de minimización de costos, tiempo, recursos, etc." %}'
    },
    'variables-count': {
        title: '{% trans "Variables" %}',
        content: '{% trans "Las variables de decisión representan las cantidades que puedes controlar en tu problema. Por ejemplo: cantidad a producir, recursos a asignar, etc." %}'
    },
    'variable-names': {
        title: '{% trans "Nombres de Variables" %}',
        content: '{% trans "Personaliza los nombres de tus variables para que sean más descriptivos. Por ejemplo: x1, x2 o Producto_A, Producto_B." %}'
    },
    'objective-function': {
        title: '{% trans "Función Objetivo" %}',
        content: '{% trans "La función que quieres optimizar. Los coeficientes representan la contribución de cada variable al objetivo (ganancia por unidad, costo por unidad, etc.)." %}'
    },
    'constraints': {
        title: '{% trans "Restricciones" %}',
        content: '{% trans "Las limitaciones de tu problema: recursos disponibles, capacidades máximas, requisitos mínimos, etc. Definen la región factible de soluciones." %}'
    },
    'constraint-types': {
        title: '{% trans "Tipo" %}',
        content: '{% trans "≤ (menor o igual): límites máximos. ≥ (mayor o igual): requisitos mínimos. = (igual): valores exactos requeridos." %}'
    },
    'example-load': {
        title: '{% trans "Cargar Ejemplo" %}',
        content: '{% trans "Carga un problema de ejemplo para ver cómo funciona el método Simplex. Útil para aprender y probar la herramienta." %}'
    },
    'solve-button': {
        title: '{% trans "Resolver con Simplex" %}',
        content: '{% trans "Ejecuta el algoritmo Simplex para encontrar la solución óptima de tu problema. El sistema mostrará el proceso paso a paso." %}'
    },
    'optimal-solution': {
        title: '{% trans "Solución Óptima" %}',
        content: '{% trans "Los valores de las variables que optimizan tu función objetivo, respetando todas las restricciones del problema." %}'
    },
    'solution-variables': {
        title: '{% trans "Variables:" %}',
        content: '{% trans "Los valores óptimos que deben tomar tus variables de decisión para lograr el mejor resultado posible." %}'
    },
    'optimal-value': {
        title: '{% trans "Valor óptimo:" %}',
        content: '{% trans "El mejor valor que puede alcanzar tu función objetivo. Este es el resultado final de la optimización." %}'
    },
    'method-used': {
        title: '{% trans "Método utilizado:" %}',
        content: '{% trans "Simplex Estándar: para restricciones ≤. Gran M: cuando hay restricciones ≥ o =, requiere variables artificiales." %}'
    },
    'step-by-step': {
        title: '{% trans "Proceso Simplex Paso a Paso" %}',
        content: '{% trans "Muestra cada iteración del algoritmo Simplex: tablas, cálculos de pivote, y transformaciones hasta llegar a la solución óptima." %}'
    },
    'graph-explanation': {
        title: '{% trans "Gráfica de Programación Lineal" %}',
        
    },
    'graph-explanation': {
        title: '{% trans "Gráfica de Programación Lineal" %}',
        content: '{% trans "Visualización geométrica del problema (solo para 2 variables). Muestra la región factible, restricciones y el punto óptimo." %}'
    }
};
</script>

<script src="{% static 'metodos_numericos/js/simplex.js' %}"></script>
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{% static 'metodos_numericos/js/simplex-graph.js' %}"></script>

{%if ejercicio_db %}
<script>
    window.cargaDB = true;
    window.numRestricciones = {{ num_restricciones }};
    window.numVariables = {{ num_variables }};
    window.nombresVariables = {{ nombres_variables_db|safe }};
</script>
{%endif%}

{% if datos_grafica %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const datosGrafica = {{ datos_grafica|safe }};
    window.datosGraficaSimplex = datosGrafica;
    
    // Inicializar gráfica después de un pequeño delay
    setTimeout(() => {
        initializeSimplexGraph(datosGrafica);
    }, 100);
    
    // Si hay datos para mantener, repoblar campos
    {% if mantener_datos %}
    setTimeout(repoblarCampos, 300);
    {% endif %}
});
</script>
{% elif mantener_datos %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Repoblar campos sin gráfica
    setTimeout(repoblarCampos, 200);
});
</script>
{% endif %}

<!-- Librerías para exportación -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="{% static 'metodos_numericos/js/simplex-export.js' %}"></script>

{% endblock %}
